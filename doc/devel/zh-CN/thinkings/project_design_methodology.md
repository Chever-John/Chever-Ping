# 设计方法：Go 优雅项目设计方法论

[![jaywcjlove/sb](https://jaywcjlove.github.io/sb/lang/chinese.svg)](project_design_methodology.md)

[English](../../en-US/thinkings/project_design_methodology.md) | [中文](project_design_methodology.md)

编写一个可以运行的代码不难，难的是成为一个 Go 编程高手。

在我为数不多的项目经历中，我发现我的代码存在很多问题，代码不规范，难以阅读；函数复用性差，代码重复率高；抽象能力低，代码扩展性差；

所以，这篇文章的目的就是为了研究，如何开发出一个优雅的 Go 项目。

那么，如果要设计出一个优雅的 Go 项目，我们该从哪些角度去思考这个问题呢？

这边提供一些角度，期望输出一份完整的文章:^)

## 思考角度

从代码结构、代码规范、代码质量、编程哲学、软件设计方法五个方面进行思考。

- 代码结构
  - 目录结构
  - 按功能拆分模块
- 代码规范
  - 编码规范：提高代码的可读性。
  - 最佳实践：在编写 Go 代码时，需要考虑提高程序的效率和性能，因为 Go 语言本身设计就是为高效并发而生的。
- 代码质量
  - 编写可测试的代码
  - 高单元测试覆盖率
  - Code Review
  - 考虑项目安全性：Go 语言提供了一些强大的安全特性，比如类型安全和内存安全，我们需要考虑这些特性以避免常见的安全漏洞。当然还有一些密钥一类的，我们可以从以下几个角度思考：
    - 漏洞扫描：这个可以使用 GitHub 的漏洞扫描工具。
    - 数据加密：对于一些涉及敏感信息的代码部分，我们需要设计好如何对这一部分进行加密。
- 编程哲学
  - 面向接口编程
  - 面向“对象”编程
- 软件设计方法
  - 设计模式
  - 遵循 SOLID 原则

## 项目可维护性

其实这一块内容大概率是跟上面是有重合的。项目的可维护性体现在代码的易读性、易修改性、扩展性和可测试性等方面。以下是提高项目可维护性的建议：

1. 代码清晰易读：尽量遵循代码规范、注释代码，严格遵循命名规范，让代码易读懂，再加上适当的空白行或缩进方式，使代码易于阅读。
2. 简化代码逻辑：在编写代码时，尽量简化代码逻辑，尽量避免嵌套的条件语句，用函数或宏来简化重复的代码，这将有助于提高代码的可读性和可测试性。
3. 单一职责的函数/类：编写单一职责的函数或类可以提高代码的可维护性。此外，尽量将每个函数的作用限制在一个模块内部。
4. 子模块化：利用子模块化原则将项目划分为可重用的组件，可以增强项目的可维护性。
5. 减少复杂度和重复代码：代码复杂度和重复代码是降低代码可维护性的两大因素，确保代码的可维护性可以大大降低这些问题的发生率。
6. 测试：编写自动化测试用例可以帮助我们快速发现程序中的问题，这有助于提高可维护性。
7. 在版本更新之间维护代码库：保持代码库的当前状态，更新第三方依赖项，并使用统一的版本控制系统对代码进行管理，这些措施可以提高代码库的可维护性，减少代码库升级风险。

### 思想：代码规范

代码规范体现了开发者的专业程度。以下是规范的具体文件说明：

#### 代码规范

代码规范：[官方的 Effective Go](https://go.dev/doc/effective_go)

#### 代码注释规范

1. 最常用的是普通注释：以“//”开头的注释，用于标记代码的功能或描述代码的某些行为或细节。
2. 函数注释是一种特殊的注释，用于描述函数或方法，它需要在函数或方法名称之后添加注释。
3. 块注释是一种多行注释，可以用于注释较长的块代码或作为分隔线使用。
4. 文档注释是一种特殊的格式化注释，用于为代码库生成自动文档，可以使用Go官方提供的godoc工具生成。

在编写注释时应该注意以下几点：

1. 精简明了：注释应该简短、明了，不需要表达太多的细节，定义、输入和输出、异常情况等都应该被提炼出来。
2. 缩进对齐：注释和代码应该对齐，这可保证代码看起来干净、整洁。
3. 语法正确：注释应该符合相应的语法规范，这可使注释更容易被人们理解，并使程序员能够更容易地将其内容展示给下一个更改代码的人。
4. 准确性：注释应该准确地描述代码的含义，所描述的内容应与实际情况相符，这可提高代码的可读性和可维护性。

综上所述，代码注释是一项非常重要的开发实践。遵循相关的注释规范可以提高代码的可读性和可维护性，为后续的项目团队开发和维护提供便利。

### 思想：简化代码逻辑

一直在添加ing。

1. 避免重复代码：如果你发现你用了同一个代码块超过2次，就应该把这段代码抽象成一个方法或一个函数。这样，代码的可读性和维护性就会大大提高。

2. 尽量使用现成的函数或库：现在有很多成熟的库和工具，可以帮助你解决大部分问题。所以，在写代码之前，你需要先调研一下是否有现成的解决方案能够帮助你实现需求。
3. 避免过度的嵌套：代码的嵌套层数过多会使代码难以阅读和维护。因此，尽量不要将过多的逻辑判断、循环嵌套在一起。
4. 使用合适的变量名：使用合适的变量名可以增强代码的可读性。建议使用具有描述性的变量名，这样可以使代码更容易理解。
5. 保持代码简洁：保持代码简洁可以帮助你避免一些不必要的错误，并且可以使代码更容易维护。要保持代码简洁，建议尽量避免过度的条件判断和冗长的方法链调用。
6. 注重代码的可读性：代码的可读性是非常重要的，因为代码通常不只是你一个人写的。因此，在编写代码的时候，要注重代码的可读性，遵守一定的代码规范，类似的逻辑功能要放在相邻的位置等。

### 思想：项目子模块

子模块化是指将一个大型的项目拆分为多个小而精的子模块，每个子模块都包含一个独立的、小而精的功能。这可以增强项目的可维护性，因为子模块化可以让我们更轻松地维护和更新项目的各个组成部分。

一个子模块通常应该包含以下内容：

1. 接口定义：该子模块提供的接口应该被详细定义，并与其他子模块的接口保持一致。
2. 功能实现：该子模块应该具有明确的责任，而且能够独立地实现其目标。
3. 测试用例：为该子模块编写自动化测试用例以检测其功能是否正常。

例如，在一个电商应用程序中，你可以将购物车、结算、支付等功能拆分为独立的子模块。这些子模块可以独立地测试、维护和更新，因为它们各自具有不同的功能，同时也有不同的处理程序。

在编写代码时，你应该将代码分成子模块，将各种功能按照相关性组织在一起。在这种方式下，代码就不会变得难以管理，在修改代码时也就更加容易分解、修改、和重新组合子模块。例如，当一个子模块不再适用或需要优化时，你就可以轻松地将其替换为一个新的子模块来实现相关的功能。这样，就可以有效地解决开发过程中的问题，帮助项目更好地进行迭代和扩展。

#### 举例说明

这边给出一个例子，是我一直在学习的 iam 系统的例子。

项目地址：https://github.com/marmotedu/iam/tree/master/internal

在这个地址里，你可以清晰看到，这个大项目分为了 apiserver、authzserver、iamctl、pump、watcher 这几个子模块。
